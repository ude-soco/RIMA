image: python:3.7

default: install

tasks:
  setup:
    command: |
      apt update &&\
      apt install -yqq --no-install-recommends -o=Dpkg::Use-Pty=0 \
        build-essential python3-dev gfortran liblapack-dev libblas-dev libatlas-base-dev libblas3 liblapack3 &&\
      pip install pipenv

  lock:
    description: Resolve package dependencies and generate Pipfile.lock
    dependencies:
    - setup
    input_paths:
    - Pipfile
    output_paths:
    - Pipfile.lock
    command: pipenv lock

  install:
    description: Install packages and display dependency tree
    dependencies:
    - lock
    input_paths:
    - Pipfile
    - Pipfile.lock
    command: pipenv install && pipenv graph
